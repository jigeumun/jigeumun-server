// 1ï¸âƒ£ í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
require("dotenv").config();

// 2ï¸âƒ£ ê¸°ë³¸ ì„œë²„ ì„¸íŒ…
const express = require("express");

const app = express();
app.use(express.json());
app.use(express.static(".")); // index.html ì œê³µ

// 3ï¸âƒ£ GPT ì‚¬ì£¼ ìƒì„± API
app.post("/api/saju", async (req, res) => {
  const { birth, time, gender } = req.body;
console.log("ë°›ì€ ê°’:", req.body);
  
const prompt = `
ë‹¹ì‹ ì€ 20ë…„ ì´ìƒ ê²½ë ¥ì˜ ë™ì–‘ ëª…ë¦¬í•™ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤.
ìƒë‹´ìžëŠ” ê²°ì œë¥¼ ì™„ë£Œí•œ ê³ ê°ìž…ë‹ˆë‹¤.
ë§íˆ¬ëŠ” ë‹¨ì •ì ì´ê³  í™•ì‹ ì— ì°¨ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.
ëª¨í˜¸í•œ í‘œí˜„, ì¼ë°˜ë¡ , ìœ„ë¡œì„± ë©˜íŠ¸ëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
í˜„ì‹¤ì ì´ê³  êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„í•˜ì‹­ì‹œì˜¤.

ì•„ëž˜ ì‚¬ì£¼ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í”„ë¦¬ë¯¸ì—„ ì‚¬ì£¼ ë¶„ì„ì„ ìž‘ì„±í•˜ì„¸ìš”.

[ìž…ë ¥ ì •ë³´]
- ìƒë…„ì›”ì¼: ${birth}
- ì¶œìƒì‹œê°„: ${time}
- ì„±ë³„: ${gender}

[ì¤‘ìš” ê·œì¹™]
- ë°˜ë“œì‹œ ì•„ëž˜ í˜•ì‹ì„ ì •í™•ížˆ ì§€ì¼œ ìž‘ì„±í•˜ì„¸ìš”.
- ê° í•­ëª©ì€ ì œëª©ì„ ë¶™ì´ê³  ì¤„ë°”ê¿ˆì„ ì¶©ë¶„ížˆ ì‚¬ìš©í•˜ì„¸ìš”.
- ì ìˆ˜ëŠ” 100ì  ë§Œì ì˜ ì •ìˆ˜ë¡œ ì œì‹œí•˜ì„¸ìš”.
- ë‚´ìš©ì€ ìµœì†Œ 1200ìž ì´ìƒ ìž‘ì„±í•˜ì„¸ìš”.
- ì¶”ìƒì ì¸ ë§ ê¸ˆì§€.
- â€œ~ì¼ ìˆ˜ ìžˆìŠµë‹ˆë‹¤â€ ê°™ì€ í‘œí˜„ ê¸ˆì§€.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ðŸ”® ì§€ê¸ˆìš´ ì ìˆ˜: XXì  (100ì  ë§Œì )

ðŸ“Œ ì „ì²´ ì‚¬ì£¼ í•µì‹¬ ìš”ì•½  
(í˜„ìž¬ ì¸ìƒ íë¦„ì„ ë‹¨ì •ì ìœ¼ë¡œ 4~6ì¤„ ì„¤ëª…)

ðŸ“Œ ì´ˆë…„ìš´ (1~30ì„¸)  
(ì„±ìž¥ ê³¼ì •, í™˜ê²½, ì„±í–¥ í˜•ì„±)

ðŸ“Œ ì¤‘ë…„ìš´ (31~50ì„¸)  
(ì‚¬íšŒì  ìœ„ì¹˜, ìž¬ë¬¼, ì¸ê°„ê´€ê³„ ì¤‘ì‹¬)

ðŸ“Œ ìž¥ë…„ìš´ (51ì„¸ ì´í›„)  
(ì•ˆì •ì„±, ì¶•ì  ìš´, ì¸ìƒ í›„ë°˜ íë¦„)

ðŸ“Œ ìŒì–‘ì˜¤í–‰ ë¶„ì„  
- ëª©ì˜ ê¸°ìš´:  
- í™”ì˜ ê¸°ìš´:  
- í† ì˜ ê¸°ìš´:  
- ê¸ˆì˜ ê¸°ìš´:  
- ìˆ˜ì˜ ê¸°ìš´:  
(ê°•í•œ ê¸°ìš´ê³¼ ì•½í•œ ê¸°ìš´ì„ ëª…í™•ížˆ êµ¬ë¶„í•˜ê³  ë³´ì™„ ë°©í–¥ ì œì‹œ)

ðŸ“Œ ì‚¬ì£¼ì— ë§žëŠ” ì§ì—…  
(êµ¬ì²´ì ì¸ ì§ì—…ëª… 5ê°€ì§€ ì´ìƒ ì œì‹œ + ì´ìœ  ì„¤ëª…)

ðŸ“Œ ì¸ê°„ê´€ê³„ ë° ì—°ì• Â·ê²°í˜¼ ì„±í–¥  
(ê²°í˜¼ ì ë ¹ê¸° í¬í•¨, ë‹¨ì •ì ìœ¼ë¡œ ì„¤ëª…)

ðŸ“Œ ì‚¬ì£¼ì™€ ê¶í•©ì´ ìž˜ ë§žëŠ” ë   
(ì´ìœ  í¬í•¨í•˜ì—¬ ì„¤ëª…)

ðŸ“Œ 2026ë…„ ìš´ì˜ íë¦„  
(ì›” ë‹¨ìœ„ë¡œ ê¸°íšŒ ì‹œê¸°ì™€ ì£¼ì˜ ì‹œê¸° êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…)

ðŸ“Œ ì§€ê¸ˆ ë°˜ë“œì‹œ í•´ì•¼ í•  í–‰ë™ ì¡°ì–¸  
(í˜„ì‹¤ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì–¸ 3ê°€ì§€)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ê²°ê³¼ëŠ” ì½ê¸° ì‰½ê²Œ ì¤„ ê°„ê²©ì„ ìœ ì§€í•˜ê³ ,
ì „ë¬¸ ìƒë‹´ ë³´ê³ ì„œì²˜ëŸ¼ ìž‘ì„±í•˜ì‹­ì‹œì˜¤.
`;

  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${process.env.OPENAI_API_KEY}`
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [{ role: "user", content: prompt }],
        temperature: 0.85
      })
    });

    const data = await response.json();

    if (!data.choices) {
      console.error("âŒ OpenAI ì‘ë‹µ ì˜¤ë¥˜:", data);
      return res.status(500).json({ error: "OpenAI ì‘ë‹µ ì˜¤ë¥˜" });
    }

    res.json({
      result: data.choices[0].message.content
    });

  } catch (err) {
    console.error("ðŸ”¥ GPT ì‚¬ì£¼ ìƒì„± ì˜¤ë¥˜:", err);
    res.status(500).json({ error: "ì‚¬ì£¼ ìƒì„± ì‹¤íŒ¨" });
  }
});

// 4ï¸âƒ£ ì„œë²„ ì‹¤í–‰
app.listen(3000, () => {
  console.log("ì§€ê¸ˆìš´ ì„œë²„ ì‹¤í–‰ ì¤‘ ðŸ‘‰ http://localhost:3000");
});
