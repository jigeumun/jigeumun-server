// 1ï¸âƒ£ í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
require("dotenv").config();

// 2ï¸âƒ£ ê¸°ë³¸ ì„œë²„ ì„¸íŒ…
const express = require("express");
const fetch = require("node-fetch");

const app = express();
app.use(express.json());
app.use(express.static(".")); // index.html ì œê³µ

// 3ï¸âƒ£ GPT ì‚¬ì£¼ ìƒì„± API
app.post("/api/saju", async (req, res) => {
  const { birth, time, gender } = req.body;
  console.log("ë°›ì€ ê°’:", req.body);

  const prompt = `
ë‹¹ì‹ ì€ 25ë…„ ê²½ë ¥ì˜ ì „ë¬¸ ëª…ë¦¬í•™ìžìž…ë‹ˆë‹¤.
ì´ ê³ ê°ì€ ì‹¤ì œ ê²°ì œë¥¼ ì™„ë£Œí•œ ìœ ë£Œ ê³ ê°ìž…ë‹ˆë‹¤.
ë°˜ë“œì‹œ ì „ë¬¸ê°€ ë³´ê³ ì„œ ìˆ˜ì¤€ìœ¼ë¡œ ìž‘ì„±í•˜ì‹­ì‹œì˜¤.

â— ë§¤ìš° ì¤‘ìš” ê·œì¹™
- ëª¨ë“  í•­ëª©ì€ ì ˆëŒ€ ë¹„ì›Œë‘ì§€ ë§ˆì‹­ì‹œì˜¤.
- ê° í•­ëª©ì€ ìµœì†Œ 4ì¤„ ì´ìƒ ìž‘ì„±í•˜ì‹­ì‹œì˜¤.
- ì§ì—… 5ê°œëŠ” ê°ê° ë°˜ë“œì‹œ 4ì¤„ ì´ìƒ ì´ìœ ë¥¼ ìž‘ì„±í•˜ì‹­ì‹œì˜¤.
- í–‰ë™ ì¡°ì–¸ 3ê°œëŠ” ê°ê° ë°˜ë“œì‹œ 3ì¤„ ì´ìƒ ì´ìœ ë¥¼ ìž‘ì„±í•˜ì‹­ì‹œì˜¤.
- "ê°€ëŠ¥ì„±", "~ì¼ ìˆ˜ ìžˆìŠµë‹ˆë‹¤", "ì°¸ê³ ìš©" ê°™ì€ í‘œí˜„ ì ˆëŒ€ ê¸ˆì§€.
- ë‹¨ì •ì ì´ê³  í™•ì‹ ì— ì°¬ ì–´ì¡° ìœ ì§€.
- ì¶”ìƒì  í‘œí˜„ ê¸ˆì§€.
- ìµœì†Œ 1800ìž ì´ìƒ ìž‘ì„±.
- ì½ê¸° ì‰½ê²Œ ì¤„ ê°„ê²© ìœ ì§€.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[ìž…ë ¥ ì •ë³´]
- ìƒë…„ì›”ì¼: ${birth}
- ì¶œìƒì‹œê°„: ${time}
- ì„±ë³„: ${gender}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. ì§€ê¸ˆìš´ ì ìˆ˜
í˜•ì‹:
ðŸ”® ì§€ê¸ˆìš´ ì ìˆ˜: 00ì  (100ì  ë§Œì )
ì ìˆ˜ ì´ìœ ë¥¼ 4ì¤„ ì´ìƒ ì„¤ëª….

2. ì „ì²´ ì‚¬ì£¼ í•µì‹¬ ìš”ì•½
í˜„ìž¬ ì¸ìƒ íë¦„ì„ 5~6ì¤„ ë‹¨ì •ì ìœ¼ë¡œ ë¶„ì„.

3. ì´ˆë…„ìš´ (1~30ì„¸)
ì„±ìž¥ í™˜ê²½, ì„±í–¥ í˜•ì„± ê³¼ì • ë¶„ì„.

4. ì¤‘ë…„ìš´ (31~50ì„¸)
ìž¬ë¬¼, ì‚¬íšŒì  ìœ„ì¹˜, ì¸ê°„ê´€ê³„ íë¦„ ë¶„ì„.

5. ìž¥ë…„ìš´ (51ì„¸ ì´í›„)
ì•ˆì •ì„±, ì¶•ì  ìš´, ì¸ìƒ í›„ë°˜ êµ¬ì¡° ë¶„ì„.

6. ìŒì–‘ì˜¤í–‰ ë¶„ì„
- ëª©ì˜ ê¸°ìš´:
- í™”ì˜ ê¸°ìš´:
- í† ì˜ ê¸°ìš´:
- ê¸ˆì˜ ê¸°ìš´:
- ìˆ˜ì˜ ê¸°ìš´:
ê° ê¸°ìš´ ê°•ì•½ê³¼ ë³´ì™„ ë°©í–¥ì„ ëª…í™•ížˆ ì„¤ëª….

7. ì‚¬ì£¼ì— ë§žëŠ” ì§ì—… 5ê°€ì§€
ì•„ëž˜ í˜•ì‹ì„ ë°˜ë“œì‹œ ì§€ì¼œ ìž‘ì„±:

1) ì§ì—…ëª…
- ì™œ ì´ ì‚¬ì£¼ êµ¬ì¡°ì— ì í•©í•œì§€ ì˜¤í–‰ ê·¼ê±° ì„¤ëª…
- ì„±í–¥ê³¼ì˜ ì—°ê²°ì„± ì„¤ëª…
- ëŒ€ìš´ íë¦„ê³¼ì˜ ì—°ê²° ì„¤ëª…
- í˜„ì‹¤ ì ìš© ê°€ëŠ¥ì„± ì„¤ëª…

(ìœ„ í˜•ì‹ìœ¼ë¡œ 5ê°œ ë°˜ë“œì‹œ ìž‘ì„±. ì ˆëŒ€ ìš”ì•½ ê¸ˆì§€.)

8. ì¸ê°„ê´€ê³„ ë° ì—°ì• Â·ê²°í˜¼ ì„±í–¥
ë°°ìš°ìž ìœ í˜•, ê²°í˜¼ ì‹œê¸° íë¦„ í¬í•¨.

9. ì‚¬ì£¼ì™€ ê¶í•©ì´ ìž˜ ë§žëŠ” ë  3ê°€ì§€
ê° ë ë§ˆë‹¤ ì´ìœ  3ì¤„ ì´ìƒ.

10. 2026ë…„ ì›”ë³„ ìš´ íë¦„
1ì›”ë¶€í„° 12ì›”ê¹Œì§€ ê¸°íšŒ ì‹œê¸°ì™€ ì£¼ì˜ ì‹œê¸° êµ¬ì²´ì  ì„¤ëª….

11. ì§€ê¸ˆ ë°˜ë“œì‹œ í•´ì•¼ í•  í–‰ë™ 3ê°€ì§€
í˜•ì‹:

1) í–‰ë™
- ì™œ ì§€ê¸ˆ í•´ì•¼ í•˜ëŠ”ì§€ êµ¬ì¡°ì  ì´ìœ 
- í•˜ì§€ ì•Šì„ ê²½ìš° ë°œìƒ ë¬¸ì œ
- ì‹¤í–‰ ì‹œ ê¸°ëŒ€ íš¨ê³¼

(ìœ„ í˜•ì‹ìœ¼ë¡œ 3ê°œ ë°˜ë“œì‹œ ìž‘ì„±.)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ì „ë¬¸ ìƒë‹´ ë³´ê³ ì„œì²˜ëŸ¼ ìž‘ì„±í•˜ê³ ,
ì ˆëŒ€ í•­ëª©ì„ ìƒëžµí•˜ì§€ ë§ˆì‹­ì‹œì˜¤.
`;

  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${process.env.OPENAI_API_KEY}`
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [
          { role: "system", content: "ë‹¹ì‹ ì€ í•œêµ­ ìµœê³  ìˆ˜ì¤€ì˜ ëª…ë¦¬í•™ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤." },
          { role: "user", content: prompt }
        ],
        temperature: 0.7
      })
    });

    const data = await response.json();

    if (!data.choices) {
      console.error("âŒ OpenAI ì‘ë‹µ ì˜¤ë¥˜:", data);
      return res.status(500).json({ error: "OpenAI ì‘ë‹µ ì˜¤ë¥˜" });
    }

    res.json({
      result: data.choices[0].message.content
    });

  } catch (err) {
    console.error("ðŸ”¥ GPT ì‚¬ì£¼ ìƒì„± ì˜¤ë¥˜:", err);
    res.status(500).json({ error: "ì‚¬ì£¼ ìƒì„± ì‹¤íŒ¨" });
  }
});

// 4ï¸âƒ£ ì„œë²„ ì‹¤í–‰
app.listen(3000, () => {
  console.log("ì§€ê¸ˆìš´ ì„œë²„ ì‹¤í–‰ ì¤‘ ðŸ‘‰ http://localhost:3000");
});
