<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì§€ê¸ˆìš´ | ë¬´ë£Œ ì‚¬ì£¼í’€ì´</title>

<style>
body {
  margin: 0;
  font-family: 'Noto Sans KR', sans-serif;
  background: #020617;
  color: white;
  display: flex;
  justify-content: center;
}
.container {
  width: 100%;
  max-width: 420px;
  padding: 24px;
}
h1 { text-align:center; }
.subtitle { text-align:center; color:#94a3b8; font-size:14px; margin-bottom:30px; }
.input-group { margin-bottom:18px; }
label { display:block; margin-bottom:6px; }
input, select { width:100%; padding:14px; border-radius:12px; border:none; font-size:15px; }
button { width:100%; padding:16px; font-size:16px; font-weight:bold; border-radius:14px; border:none; cursor:pointer; }
.primary { background:#6366f1; color:white; }
.card { background:#0f172a; padding:20px; border-radius:16px; margin-top:24px; }
.error { color:#f87171; font-size:13px; display:none; }
</style>
</head>

<body>
<div class="container">

<h1>ğŸ”® ì§€ê¸ˆìš´</h1>
<div class="subtitle">ì§€ê¸ˆ ì´ ì„ íƒ, ì‚¬ì£¼ë¡œ í™•ì¸í•˜ì„¸ìš”.</div>

<div class="input-group">
<label>ìƒë…„ì›”ì¼</label>
<input type="date" id="birth">
<div class="error" id="birthErr">ì…ë ¥ í•„ìš”</div>
</div>

<div class="input-group">
<label>ì¶œìƒì‹œê°„</label>
<input type="time" id="time">
<label><input type="checkbox" id="timeUnknown"> ëª¨ë¦„</label>
<div class="error" id="timeErr">ì…ë ¥ í•„ìš”</div>
</div>

<div class="input-group">
<label>ì„±ë³„</label>
<select id="gender">
<option value="">ì„ íƒ</option>
<option>ë‚¨ì„±</option>
<option>ì—¬ì„±</option>
</select>
<div class="error" id="genderErr">ì„ íƒ í•„ìš”</div>
</div>

<button id="freeBtn" class="primary">âœ¨ ë¬´ë£Œ ì‚¬ì£¼í’€ì´ ë³´ê¸°</button>

<div id="result" class="card" style="display:none;">
<h3>ğŸ“œ ì˜¤ëŠ˜ì˜ ë¬´ë£Œ ì‚¬ì£¼</h3>
<p id="mainLuck"></p>

<h4>ğŸ’– ì—°ì• ìš´</h4>
<p id="loveLuck"></p>

<hr style="opacity:0.2; margin:20px 0;">

<h4>ğŸ”’ ì—¬ê¸°ê¹Œì§€ ë¬´ë£Œì…ë‹ˆë‹¤</h4>
<p style="font-size:14px;">
âœ” ì˜¬í•´ ì „ì²´ ìš´ì˜ íë¦„<br>
âœ” ìƒëŒ€ ì†ë§ˆìŒ ë¶„ì„<br>
âœ” ê¸ˆì „ Â· ì§ì—… Â· ì‹œê¸°ë³„ ìš´ì„¸
</p>

<button id="paymentBtn" class="primary" style="display:none;">
ğŸ’³ ìì„¸í•œ í’€ì´ ë³´ê¸° Â· 2,900ì›
</button>
</div>

<div id="payment" class="card" style="display:none;">
<h3>ğŸ’³ ì§€ê¸ˆìš´ í”„ë¦¬ë¯¸ì—„</h3>
<p style="font-size:14px; line-height:1.6;"> 
âœ” 2026ë…„ ì „ì²´ ìš´ì„¸<br> 
âœ” ì—°ì•  ê¶í•© & ì¬íšŒ ê°€ëŠ¥ì„±<br> 
âœ” ê¸ˆì „ìš´ í­ë°œ ì‹œê¸° ë¶„ì„<br><br> 
<b>ê²°ì œê¸ˆì•¡ : 2,900ì› (1íšŒ)</b> 
</p>

<h4>ğŸ”® í”„ë¦¬ë¯¸ì—„ ì‚¬ì£¼ ê²°ê³¼</h4>
<p id="gptResult" style="white-space:pre-line; font-size:14px; line-height:1.6;">
ì‚¬ì£¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
</p>
</div>

<div id="refundPolicy" class="card" style="display:none; font-size:13px;">
<h4>ğŸ“Œ ì·¨ì†Œ ë° í™˜ë¶ˆ ì •ì±…</h4>
<p>
ë³¸ ì„œë¹„ìŠ¤ëŠ” ë””ì§€í„¸ ì½˜í…ì¸  íŠ¹ì„±ìƒ<br> 
ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ê°€ ì œê³µëœ ì´í›„ì—ëŠ” í™˜ë¶ˆì´ ì–´ë µìŠµë‹ˆë‹¤.<br><br> 
ë‹¨, ê²°ì œ ì˜¤ë¥˜ ë˜ëŠ” ì„œë¹„ìŠ¤ ë¯¸ì œê³µ ë“±<br> 
íšŒì‚¬ì˜ ê·€ì±… ì‚¬ìœ ê°€ ìˆëŠ” ê²½ìš°ì—ëŠ”<br> 
ê²°ì œì¼ë¡œë¶€í„° 7ì¼ ì´ë‚´ í™˜ë¶ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. 
</p>
</div>

</div>

<script src="https://js.tosspayments.com/v1"></script>
<script>

const mainLuckTexts = [
"ì§€ê¸ˆì€ ë©ˆì¶¤ ì†ì—ì„œ ê¸°íšŒê°€ ìë¼ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
"ê³¼ê±°ì˜ ì„ íƒì´ ë‹¤ì‹œ ëŒì•„ì˜¤ëŠ” íë¦„ì…ë‹ˆë‹¤.",
"ì‘ì€ ê²°ë‹¨ì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
"ì‚¬ëŒì„ í†µí•´ ìš´ì´ ì—´ë¦¬ëŠ” ì‹œì ì…ë‹ˆë‹¤."
];

const loveLuckTexts = [
"ì—°ì• ìš´ì´ ì„œì„œíˆ ì‚´ì•„ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.",
"ê³¼ê±° ì¸ì—°ê³¼ì˜ ì¬ì—°ê²° ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.",
"ì¡°ê¸‰í•¨ì„ ë‚´ë ¤ë†“ì„ìˆ˜ë¡ ê´€ê³„ê°€ ê¹Šì–´ì§‘ë‹ˆë‹¤.",
"ê°ì •ì„ ìˆ¨ê¸°ì§€ ì•ŠëŠ” ê²ƒì´ ê´€ê±´ì…ë‹ˆë‹¤."
];

document.getElementById("freeBtn").addEventListener("click", () => {

  const birth = birth.value;
  const time = time.value;
  const timeUnknown = timeUnknown.checked;
  const gender = gender.value;

  birthErr.style.display = timeErr.style.display = genderErr.style.display = "none";

  if (!birth) return birthErr.style.display="block";
  if (!time && !timeUnknown) return timeErr.style.display="block";
  if (!gender) return genderErr.style.display="block";

  mainLuck.innerText = mainLuckTexts[Math.floor(Math.random()*mainLuckTexts.length)];
  loveLuck.innerText = loveLuckTexts[Math.floor(Math.random()*loveLuckTexts.length)];

  result.style.display = "block";
  paymentBtn.style.display = "block";

  // â­ï¸ ê²°ì œ ì „ì— ì €ì¥
  localStorage.setItem("sajuData", JSON.stringify({
    birth,
    time: timeUnknown ? "ëª¨ë¦„" : time,
    gender
  }));
});

paymentBtn.addEventListener("click", () => {

  const toss = TossPayments("test_ck_GjLJoQ1aVZ21ybq9bjRJVw6KYe2R");

  toss.requestPayment("ì¹´ë“œ", {
    amount: 2900,
    orderId: "order_" + Date.now(),
    orderName: "ì§€ê¸ˆìš´ í”„ë¦¬ë¯¸ì—„",
    customerName: "í…ŒìŠ¤íŠ¸",
    successUrl: location.origin + location.pathname + "?payment=success",
    failUrl: location.origin + location.pathname + "?payment=fail"
  });
});

window.addEventListener("load", () => {

  if (new URLSearchParams(location.search).get("payment") === "success") {

    result.style.display = "block";
    payment.style.display = "block";
    refundPolicy.style.display = "block";

    fetchPremiumSaju();
  }
});

async function fetchPremiumSaju() {

  const saved = JSON.parse(localStorage.getItem("sajuData"));

  if (!saved) {
    gptResult.innerText = "âš ï¸ ì‚¬ì£¼ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
    return;
  }

  gptResult.innerText = "ğŸ”® ì‚¬ì£¼ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";

  try {
    const res = await fetch("/api/saju", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(saved)
    });

    const data = await res.json();
    gptResult.innerText = data.result || "âš ï¸ ì‚¬ì£¼ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";

  } catch (e) {
    console.error(e);
    gptResult.innerText = "âš ï¸ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
  }
}

</script>
</body>
</html>
