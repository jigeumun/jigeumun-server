<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì§€ê¸ˆìš´ | ë¬´ë£Œ ì‚¬ì£¼í’€ì´</title>

<style>
body {
  margin: 0;
  font-family: 'Noto Sans KR', sans-serif;
  background: #020617;
  color: white;
  display: flex;
  justify-content: center;
}
.container {
  width: 100%;
  max-width: 420px;
  padding: 24px;
}
h1 { text-align:center; }
.subtitle { text-align:center; color:#94a3b8; font-size:14px; margin-bottom:30px; }
.input-group { margin-bottom:18px; }
label { display:block; margin-bottom:6px; }
input, select { width:100%; padding:14px; border-radius:12px; border:none; font-size:15px; }
button { width:100%; padding:16px; font-size:16px; font-weight:bold; border-radius:14px; border:none; cursor:pointer; }
.primary { background:#6366f1; color:white; }
.card { background:#0f172a; padding:20px; border-radius:16px; margin-top:24px; }
.error { color:#f87171; font-size:13px; display:none; }

/* ì ìˆ˜ ë°” */
.scoreBarWrap {
  margin-top:15px;
  background:#1e293b;
  border-radius:12px;
  overflow:hidden;
}
.scoreBar {
  height:14px;
  width:0%;
  background:linear-gradient(90deg,#6366f1,#22d3ee);
  transition:width 1s ease;
}
.scoreText {
  margin-top:8px;
  font-weight:bold;
}

/* ë¡œë”© */
.loader {
  border:4px solid rgba(255,255,255,0.1);
  border-top:4px solid #6366f1;
  border-radius:50%;
  width:30px;
  height:30px;
  animation:spin 1s linear infinite;
  margin:15px auto;
}
@keyframes spin {
  0% { transform:rotate(0deg); }
  100% { transform:rotate(360deg); }
}

/* ì¹´ë“œ */
.resultCard {
  background:#111827;
  padding:18px;
  border-radius:16px;
  margin-top:20px;
  border:1px solid rgba(255,255,255,0.08);
}
.resultCard h4 {
  margin:0 0 10px 0;
  color:#a78bfa;
  font-size:15px;
}
.resultCard p {
  margin:0;
  font-size:14px;
  line-height:1.7;
  color:#e5e7eb;
}

/* ğŸ”¥ ì „í™˜ ìœ ë„ ë¸”ë¡ */
.premiumTease {
  margin-top:20px;
  background:linear-gradient(135deg,#1e293b,#0f172a);
  padding:18px;
  border-radius:16px;
  border:1px solid rgba(99,102,241,0.4);
}
.premiumTease h4 {
  margin:0 0 10px 0;
  color:#22d3ee;
}
.premiumTease p {
  font-size:14px;
  line-height:1.6;
  color:#cbd5e1;
}

/* ğŸ”¥ í›„ê¸° */
.reviewCard {
  background:#0b1220;
  padding:16px;
  border-radius:14px;
  margin-top:14px;
  font-size:13px;
  color:#cbd5e1;
  border:1px solid rgba(255,255,255,0.05);
}
.reviewCard strong {
  color:#facc15;
}
</style>
</head>

<body>
<div class="container">

<h1>ğŸ”® ì§€ê¸ˆìš´</h1>
<div class="subtitle">ì§€ê¸ˆ ì´ ì„ íƒ, ì‚¬ì£¼ë¡œ í™•ì¸í•˜ì„¸ìš”.</div>

<!-- ğŸ”¥ ì´ìš©ì ìˆ˜ í‘œì‹œ -->
<div style="text-align:center; font-size:13px; color:#94a3b8; margin-bottom:20px;">
ì˜¤ëŠ˜ <strong id="todayCount"></strong>ëª…ì´ ì§€ê¸ˆìš´ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤
</div>

<div class="input-group">
<label>ìƒë…„ì›”ì¼</label>
<input type="date" id="birth">
<div class="error" id="birthErr">ì…ë ¥ í•„ìš”</div>
</div>

<div class="input-group">
<label>ì¶œìƒì‹œê°„</label>
<input type="time" id="time">
<label><input type="checkbox" id="timeUnknown"> ëª¨ë¦„</label>
<div class="error" id="timeErr">ì…ë ¥ í•„ìš”</div>
</div>

<div class="input-group">
<label>ì„±ë³„</label>
<select id="gender">
<option value="">ì„ íƒ</option>
<option>ë‚¨ì„±</option>
<option>ì—¬ì„±</option>
</select>
<div class="error" id="genderErr">ì„ íƒ í•„ìš”</div>
</div>

<button id="freeBtn" class="primary">âœ¨ ë¬´ë£Œ ì‚¬ì£¼í’€ì´ ë³´ê¸°</button>

<div id="result" class="card" style="display:none;">
<h3>ğŸ“œ ì˜¤ëŠ˜ì˜ ë¬´ë£Œ ì‚¬ì£¼</h3>
<p id="mainLuck"></p>

<h4>ğŸ’– ì—°ì• ìš´</h4>
<p id="loveLuck"></p>

<hr style="opacity:0.2; margin:20px 0;">

<h4>ğŸ”’ ì—¬ê¸°ê¹Œì§€ ë¬´ë£Œì…ë‹ˆë‹¤</h4>
<p style="font-size:14px;">
âœ” ì•ìœ¼ë¡œ 3ë…„ ëŒ€ìš´ íë¦„<br>
âœ” ì§€ê¸ˆ ì„ íƒì´ ì¸ìƒì— ë¯¸ì¹˜ëŠ” ì˜í–¥<br>
âœ” ê¸ˆì „ Â· ì§ì—… Â· ì‹œê¸°ë³„ ì •ë°€ ë¶„ì„
</p>

<!-- ğŸ”¥ ì „í™˜ ê°•í™” ë¸”ë¡ -->
<div class="premiumTease">
<h4>ğŸ’ í”„ë¦¬ë¯¸ì—„ì—ì„œ í™•ì¸ ê°€ëŠ¥</h4>
<p>
ì§€ê¸ˆì€ â€˜ìƒìŠ¹ ì´ˆì…â€™ êµ¬ê°„ì…ë‹ˆë‹¤.<br>
âœ” ì˜¬í•´ ëˆë³µ íë¦„<br>
âœ” ë°˜ë“œì‹œ í”¼í•´ì•¼ í•  ì„ íƒ 1ê°€ì§€<br>
âœ” ì§€ê¸ˆ í•´ì•¼ í•  í–‰ë™ 1ê°€ì§€<br>
âœ” ë‹¹ì‹ ì˜ ìš´ ìƒìŠ¹ ë°©í–¥
</p>
</div>

<button id="paymentBtn" class="primary" style="display:none;">
ğŸ’³ ì§€ê¸ˆìš´ ì™„ì „ í•´ì„ ë³´ê¸° Â· 2,900ì›
</button>
</div>

<div id="payment" class="card" style="display:none;">
<h3>ğŸ’³ ì§€ê¸ˆìš´ í”„ë¦¬ë¯¸ì—„</h3>

<div id="loadingBox" style="display:none; text-align:center;">
<p>ğŸ”® ì‚¬ì£¼ë¥¼ ì •ë°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
<div class="loader"></div>
</div>

<div id="scoreSection" style="display:none;">
<h4>ğŸ“Š ì§€ê¸ˆìš´ ì ìˆ˜</h4>
<div class="scoreBarWrap">
<div class="scoreBar" id="scoreBar"></div>
</div>
<div class="scoreText" id="scoreText"></div>
</div>

<div id="gptResult"></div>

</div>

<!-- ğŸ”¥ í›„ê¸° ì„¹ì…˜ -->
<div class="card">
<h4>â­ ì‹¤ì œ ì´ìš© í›„ê¸°</h4>

<div class="reviewCard">
<strong>â˜…â˜…â˜…â˜…â˜…</strong><br>
â€œì†”ì§íˆ ê¸°ëŒ€ ì•ˆ í–ˆëŠ”ë° ë„ˆë¬´ ì •í™•í•´ì„œ ë†€ëì–´ìš”.â€
</div>

<div class="reviewCard">
<strong>â˜…â˜…â˜…â˜…â˜…</strong><br>
â€œëŒ€ìš´ íë¦„ ì„¤ëª…ì´ ì§„ì§œ ì†Œë¦„â€¦ ê²°ì œí•˜ê¸¸ ì˜í–ˆì–´ìš”.â€
</div>

<div class="reviewCard">
<strong>â˜…â˜…â˜…â˜…â˜†</strong><br>
â€œì§€ê¸ˆ ì„ íƒ ê³ ë¯¼ ì¤‘ì´ì—ˆëŠ”ë° ë°©í–¥ì´ ì •ë¦¬ëìŠµë‹ˆë‹¤.â€
</div>
</div>

<div id="refundPolicy" class="card" style="display:none; font-size:13px;">
<h4>ğŸ“Œ ì·¨ì†Œ ë° í™˜ë¶ˆ ì •ì±…</h4>
<p>
ë³¸ ì„œë¹„ìŠ¤ëŠ” ë””ì§€í„¸ ì½˜í…ì¸  íŠ¹ì„±ìƒ<br> 
ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ê°€ ì œê³µëœ ì´í›„ì—ëŠ” í™˜ë¶ˆì´ ì–´ë µìŠµë‹ˆë‹¤.<br><br> 
ë‹¨, ê²°ì œ ì˜¤ë¥˜ ë˜ëŠ” ì„œë¹„ìŠ¤ ë¯¸ì œê³µ ë“±<br> 
íšŒì‚¬ì˜ ê·€ì±… ì‚¬ìœ ê°€ ìˆëŠ” ê²½ìš°ì—ëŠ”<br> 
ê²°ì œì¼ë¡œë¶€í„° 7ì¼ ì´ë‚´ í™˜ë¶ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
</p>
<p style="margin-top:12px; color:#94a3b8;"> 
ë¬¸ì˜: kmatin0035@gmail.com<br><br> 
Â© 2026 ì§€ê¸ˆìš´ | ì½˜í…ì¸  ì„œë¹„ìŠ¤<br> 
ë³¸ ì„œë¹„ìŠ¤ëŠ” ì°¸ê³ ìš© ì½˜í…ì¸ ì…ë‹ˆë‹¤
</p>
</div>

</div>

<script src="https://js.tosspayments.com/v1"></script>
<script>

document.getElementById("todayCount").innerText =
  Math.floor(Math.random()*120)+80;

const paymentBtn = document.getElementById("paymentBtn");
const result = document.getElementById("result");
const payment = document.getElementById("payment");
const refundPolicy = document.getElementById("refundPolicy");
const gptResult = document.getElementById("gptResult");
const scoreBar = document.getElementById("scoreBar");
const scoreText = document.getElementById("scoreText");
const scoreSection = document.getElementById("scoreSection");
const loadingBox = document.getElementById("loadingBox");

const mainLuckTexts = [
"ì§€ê¸ˆì€ ë©ˆì¶¤ ì†ì—ì„œ ê¸°íšŒê°€ ìë¼ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
"ê³¼ê±°ì˜ ì„ íƒì´ ë‹¤ì‹œ ëŒì•„ì˜¤ëŠ” íë¦„ì…ë‹ˆë‹¤.",
"ì‘ì€ ê²°ë‹¨ì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
"ì‚¬ëŒì„ í†µí•´ ìš´ì´ ì—´ë¦¬ëŠ” ì‹œì ì…ë‹ˆë‹¤."
];

const loveLuckTexts = [
"ì—°ì• ìš´ì´ ì„œì„œíˆ ì‚´ì•„ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.",
"ê³¼ê±° ì¸ì—°ê³¼ì˜ ì¬ì—°ê²° ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.",
"ì¡°ê¸‰í•¨ì„ ë‚´ë ¤ë†“ì„ìˆ˜ë¡ ê´€ê³„ê°€ ê¹Šì–´ì§‘ë‹ˆë‹¤.",
"ê°ì •ì„ ìˆ¨ê¸°ì§€ ì•ŠëŠ” ê²ƒì´ ê´€ê±´ì…ë‹ˆë‹¤."
];

document.getElementById("freeBtn").addEventListener("click", () => {

  const birthVal = document.getElementById("birth").value;
  const timeVal = document.getElementById("time").value;
  const timeUnknown = document.getElementById("timeUnknown").checked;
  const genderVal = document.getElementById("gender").value;

  document.getElementById("birthErr").style.display = "none";
  document.getElementById("timeErr").style.display = "none";
  document.getElementById("genderErr").style.display = "none";

  if (!birthVal) return document.getElementById("birthErr").style.display="block";
  if (!timeVal && !timeUnknown) return document.getElementById("timeErr").style.display="block";
  if (!genderVal) return document.getElementById("genderErr").style.display="block";

  document.getElementById("mainLuck").innerText =
    mainLuckTexts[Math.floor(Math.random()*mainLuckTexts.length)];

  document.getElementById("loveLuck").innerText =
    loveLuckTexts[Math.floor(Math.random()*loveLuckTexts.length)];

  result.style.display = "block";
  paymentBtn.style.display = "block";

  localStorage.setItem("sajuData", JSON.stringify({
    birth: birthVal,
    time: timeUnknown ? "ëª¨ë¦„" : timeVal,
    gender: genderVal
  }));
});

paymentBtn.addEventListener("click", () => {
  const toss = TossPayments("test_ck_GjLJoQ1aVZ21ybq9bjRJVw6KYe2R");
  toss.requestPayment("ì¹´ë“œ", {
    amount: 2900,
    orderId: "order_" + Date.now(),
    orderName: "ì§€ê¸ˆìš´ í”„ë¦¬ë¯¸ì—„",
    customerName: "í…ŒìŠ¤íŠ¸",
    successUrl: location.origin + location.pathname + "?payment=success",
    failUrl: location.origin + location.pathname + "?payment=fail"
  });
});

window.addEventListener("load", () => {
  if (new URLSearchParams(location.search).get("payment") === "success") {
    result.style.display = "block";
    payment.style.display = "block";
    refundPolicy.style.display = "block";
    fetchPremiumSaju();
  }
});

async function fetchPremiumSaju() {

  const saved = JSON.parse(localStorage.getItem("sajuData"));
  if (!saved) {
    gptResult.innerHTML = "âš ï¸ ì‚¬ì£¼ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }

  loadingBox.style.display = "block";
  scoreSection.style.display = "none";
  gptResult.innerHTML = "";

  try {
    const res = await fetch("/api/saju", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(saved)
    });

    const data = await res.json();
    loadingBox.style.display = "none";

    const text = data.result || "âš ï¸ ì‚¬ì£¼ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";

    const scoreMatch = text.match(/ì§€ê¸ˆìš´ ì ìˆ˜\s*[:ï¼š]?\s*(\d+)/);
    const score = scoreMatch ? parseInt(scoreMatch[1]) : Math.floor(Math.random()*41)+60;

    scoreSection.style.display = "block";
    scoreBar.style.width = score + "%";

    let level = "";
    if(score <= 40) level="ğŸ”´ í•˜ë½ êµ¬ê°„";
    else if(score <=70) level="ğŸŸ¡ ë³´í†µ íë¦„";
    else if(score <=85) level="ğŸŸ¢ ìƒìŠ¹ íë¦„";
    else level="ğŸ”µ ê°•ìš´ êµ¬ê°„";

    scoreText.innerText = score + "ì  Â· " + level;

    const sections = text.split(/\n(?=\d+\.)/);

    sections.forEach(sec=>{
      const lines = sec.trim().split("\n");
      const title = lines[0].trim();
      const body = lines.slice(1).join("\n").trim();

      const card = document.createElement("div");
      card.className = "resultCard";

      const h = document.createElement("h4");
      h.innerText = title;

      const p = document.createElement("p");
      p.innerText = body || "ì´ í•­ëª©ì— ëŒ€í•œ êµ¬ì²´ì  ì´ìœ  ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤.";

      card.appendChild(h);
      card.appendChild(p);
      gptResult.appendChild(card);
    });

  } catch (e) {
    loadingBox.style.display = "none";
    gptResult.innerHTML = "âš ï¸ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ";
  }
}

</script>
</body>
</html>
